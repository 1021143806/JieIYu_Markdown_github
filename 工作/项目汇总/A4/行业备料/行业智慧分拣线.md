# 行业智慧分拣线项目

## 项目背景

项目评估时确认方案，AGV 任务分为两段，第一段为：货架区到缓存区，第二段为：缓存区到机台。当时评估 AGV 从缓存区到机台时间小于 20s 。

这点在现场观察后不合理且无法实现，导致 AGV 效率不足，之后多次讨论并修改以及验证方案，大部分方案均因物流线效率与 AGV 效率不一致导致理论上无法达到要求，一方效率低则会导致环线堵塞，从而该工单需要再循环一圈增加2分钟等待时间。

因一方效率提升的同时将导致其他多方效率降低，因此方案进行了多次修改，AGV 方面共三个大方向：

1. 排队区（环线压力大）

   ![image-20240812143522753](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812143522753.png)

2. 缓存区（AGV 压力大）

   ![image-20240812143555384](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812143555384.png)

3. 排队区 + 缓存区（目前方案）（业务逻辑可以遇到较多问题）

   ![image-20240812143539999](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812143539999.png)

每一个方案的 AGV 地图均不相同，一般 AGV 地图修改需要 1-2 天陪产投运来进行地图相关的问题处理，频繁修改地图也是导致测试时问题较多的一个原因之一。

目标：在多方协调下实现多方效率相近从而提高整体效率来满足要求

## 业务流程

物料通过自动分拣，进入大环线，在大环线向 RCS 发送叫车任务（库区到缓存区），物料进入小环线，向 RCS 发送上架任务（缓存区到机台），完成上架

## AGV 测试中发现并解决的问题

1. AGV 效率不足，无法满足大料 300/h

   1. 方案问题，库区到缓存区，缓存区到机台，到机台任务评估问题，无法实现 20s 内到达，即使排除堵车后走弧线最优速度也至少需要 40s+，通过掐秒分析，不走弧线的情况下每一个转弯约需花费 10s。
   
   2. 多方重新评估方案，最终决定使用混料+排队区+缓存区的方案。
   
   3. 算法介入给出地图路线修改建议，根据现场情况进行地图修改，修改后地图（仅上架）一个货架从库区到缓存区约 1 分 30s ，结合跨环境等其他业务进行修改地图后效率会一定程度降低，实际场景为上架和下架同时进行，根据实际情况再进行二次优化。整体采用竖向环线，局部使用双向提高出库效率
   
      ![image-20240812143845645](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812143845645.png)

------------------------------
2. 任务无跳过任务，导致堵车效率低下

   1. 增加跳过任务流程

      1. 设备在回库过程中可以接回缓存区任务和去机台任务

         ​	回库子任务可跳过
         ​	去缓存区前半段子任务可跳过

      2. 设备在去缓存区过程中可以接去机台任务

         ​	去缓存区后半段任务可跳过
------------------------------
3. 测试时无设备接去缓存区的任务（所有任务不开始）

   1. 缓存区分为左右两边，当时现场右侧缓存区有托盘放置，因此设置禁行区。观察发现左侧缓存区没有设备执行，只有下发上架任务才是开始执行空车移动，排查发现所有去货架区任务均只执行空车移动。
   2. 关闭禁行区后发现可以正常执行去缓存区任务，关闭前该任务选不到点。
   3. 怀疑是 RCS 选点问题分别在测试区域中进行测试，货架搬运，使用 RCS 选点，选择一个片区域，然后将其中一个点设为禁行区。在 4.3 平台版本和 4.2 平台版本均搭建一个测试区域。
      结果发现，4.3 版本环境下 RCS 选点无该问题，任务可以正常选到点。4.2 版本环境下 RCS选点始终无法开始。
   4. 结论，4.3 版本下该问题已优化过，但因为该问题为测试时发现，现场实际使用时不会开启禁行区，因此对正常业务没影响。
   
   详细过程：

> rcs+选点在禁行区内导致正常任务卡在选点不执行（4.2版本问题，4.3无该问题）

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps1.jpg) 

> 晚上测试时缓存区没有车来的原因

2024年8月1日，由于现场右侧放有物料没有搬走导致打开了禁行区

在开启右边禁行区之前有两个货架到达左边缓存区，之后没有货架再到达缓存区。

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps2.jpg) 

该问题白天时发现：有点位下发上架任务（指定点位）始终选不到点，未找到原因，在晚上测试快结束时发现有货架一直处于选不到点的情况，关闭该禁行区后可以正常执行。

确认问题为 4.2 版本的算法 RCS 选点问题。当一个 RCS 选点的片区域，中间有一个点位位于禁行区中时，会导致该任务模板所有任务均选不到点，不执行。

D0045货架

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps3.jpg) 

因为 rcs 选点位于禁行区中，导致无法选点，“库区到缓存区_放下货架大件”这个任务模板始终不开始执行，当物料进入小环线下发“缓存区上料_up”任务后，前一个任务跳过了 rcs 选点 的子任务，所以任务开始执行，到缓存区的任务开始执行空车移动，执行完成后开始执行上料任务。

因此 8 月 1 日晚测试流程为无缓存区，物料到达小环线时下发到机台的任务。

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps4.jpg) 

去缓存区任务的开始时间均在上料任务创建时间之后。

> 8 月 1 日白天工作台指定点上架任务不执行的原因

白天 wms 测试有下发“库区到缓存区_放下货架大件”和“缓存区上料_up”任务，触发了 rcs 选点，但是由于指定的片区域有点位位于禁行区，导致始终卡住选点阶段

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps5.jpg) 

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps6.jpg) 

白天有去缓存区的任务下发

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps7.jpg) 

rcs 选点无法选到点的同时将这四个点位容量锁住，导致指定点的任务也无法下发。

> 测试环境验证

10.68.2.1 服务器，4.2版本

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps8.jpg) 

正常可以执行，开启一个点禁行后任务无法执行

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps9.jpg) 

关闭禁行区后恢复，可以执行

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps10.jpg) 

10.68.2.10 服务器，4.3版本，正常执行

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps11.jpg) 

![img](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\wps12.jpg)  


------------------------------
4. 测试时仅有少量设备接取缓存区的任务（3辆车）

   1. tps 容量管控导致，片区域中含有 3 个工作台，工作台属性有 1 容量，导致该任务容量被 tps 管控为 3 。去缓存区的任务只能同时开始执行 3 个导致效率低。
2. 修改地图去除三个工作台，改为没有容量属性的机台点
   
5. 机台叫车错位，a 机台叫车货架实际在 b 机台排队

   1. 有一个货架位于排队位，wms 下发了回库，但实际没回库导致
      调用接口的时候调用的是未开始已下发的208任务，正在等待继续任务的202任务没有调用

   2. 经过排查后发现原因为：设备位于第二个机台位置，此时该货架被下发了下一个机台的任务，发送了任务合并，因此调用接口时查到的的是下一个任务，同时由于此时机台有货架，该货架位于排队点没有动，所以算法没有进行规划路线，所以不会上报排队区状态，导致该问题。

   3. 更改地图，中间运行区改为排队区，这样任务会选到排队区，从而上报任务状态避免该问题。

      ![image-20240812144428878](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812144428878.png)

6. wms 一个机台下发3个任务，但实际来了 5 辆车

   1. 由问题 5 导致，问题 5 中 wms 下发了回库，但实际没回库，来了第四辆车，第四辆车位于排队区外（属于异常），wms 下发回库，wms 信息为完成，可以接受下一个，但实际货架还没回去。

      ![image-20240812144527825](C:\git\JieIYu_Markdown_1\工作\行业智慧分拣线.assets\image-20240812144527825.png)

   











