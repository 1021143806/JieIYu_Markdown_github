# 出库到龙门架

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```
{
    "modelProcessCode": "xiajiamuban",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "33250213",    ----龙门架后面的点
            "shelfNumber": "A0887"    ----货架编号
        }
    ]
}
```



# 出库到下架机械臂

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "xiajiamubanjxb",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",    ----龙门架后面的点(不用发)
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"    ----设备编号
        }
    ]
}
```

​		出库到下架机械臂的任务报文中，deviceNum的下发取自于过龙门架任务结束时任务状态上报的deviceNum字段。

# 货架旋转

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```java
{
    "modelProcessCode": "xiajiamubanshelfchange",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "33250337@A"[袁征寰1],    ----货架旋转完的目标点以及角度信息
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"      ----设备编号
        }
    ]
}
```

​		货架旋转本质上是ICS生成一条新任务，当生成的旋转货架任务上报结束后，WMS即可通知机械臂旋转完成，机械臂开始执行动作即可。

# 任务状态上报

当小车到达工作台，并且将货架放下时，RCS给WMS反馈 ，报文格式如下

```json
{
    "shelfCurrPosition": "88005152",
    "subTaskStatus": "3",
    "orderId": "SH469820242050712118110066",
    "deviceCode": "case0003",
    "modelProcessCode": "test",
    "subTaskTypeId": "5",
    "subTaskId": "2932",
    "deviceNum": "q3vr",
    "qrContent": "88005152",
    "qrCode": "88005152",
    "subTaskSeq": "4",
    "shelfNumber": "23322",
    "icsTaskOrderDetailId": "1079",
    "processRate": "1/1",
    "status": 8
}
```

​	status为8表示为任务已经结束，即AGV已放下货架，机械臂可开始动作。

# AGV到排队区任务状态上报

​	因WMS/机械臂需要对上架排队区的容量进行管理，因此RCS在排队区时，会给WMS上报特殊状态 ，报文格式如下：

```json
{
    "orderId": "xxxddfff14",   -----订单ID
    "queuePoint": "88001092",  ----排队区的入口点编号
    "deviceCode": "ioio0002",     -------设备序列号  这个可不用太过于关注
    "modelProcessCode": "liftMoveShelf8",     -----当前执行任务的模板编号
    "subTaskTypeId": "2",    ------子任务类型
    "subTaskId": "2911",     -----子任务序号
    "deviceNum": "TznG",      -------设备编号  在下发任务的时候，deviceNum字段取自于这个 
    "qrContent": "88001095",   ------设备当前所在点名称
    "qrCode": "88001095",    -----设备当前所在点编号
    "subTaskSeq": "2",     ------子任务序号
    "shelfNumber": "A99",    -----货架编号
    "icsTaskOrderDetailId": "1076",    -----  ics内部使用ID   不用关注
    "processRate": "1/1",     -----不用关注
    "status": 11    -------状态，状态11表示该车在排队区排队
}
```

​		status为11表示小车现在在排队区等待。

# 下架结束货架回库

​		当下架结束后，AGV需要回库，需要WMS下发回库任务，报文如下

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "xiajiamubanhk",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",          ----不用发
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"      ----设备编号
        }
    ]
}
```

# 下架结束上架

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "xiajiamubandownendtoup",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "99921946",   ----下架工作台点位
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"      ----设备编号
        }
    ]
}
```

# 到异常区任务

>  请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "daoyichangqu",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",   ----货架当前所在点(不用发)
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"      ----设备编号
        }
    ]
}
```

# 到异常区人工确认任务后回库

​		到异常区，人工确认需要WMS调用RCS继续任务接口

>  请求地址：http://10.68.2.10:7000/ics/out/task/continueTask
>
> 任务报文：

```json
{
	"orderId":"WenDingXingTaskTest514",  ----订单号
    "shelfNumber":"A001"-----负载的货架编号
}

```

​	上面示例中，orderId和shelfNumber二选一传入即可。
[袁征寰1]AB面怎么定义，当前待传伟确认，上位机来发



----------



> 2024年12月17日



# 到上架机械臂

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "shangjiamubanjxb",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",    ----龙门架后面的点(不用发)
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"    ----设备编号(若非预占不用发)
        }
    ]
}
```

​		出库到下架机械臂的任务报文中，deviceNum的下发取自于过龙门架任务结束时任务状态上报的deviceNum字段。

# 下架机械臂到上架机械臂

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
>
> 任务报文：

```json
{
    "modelProcessCode": "xiajiamubandownendtoupJXB",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",    ----不用发
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"    ----设备编号(若非预占不用发)
        }
    ]
}
```

# 货架回库不放下货架继续任务

> 请求地址：http://10.68.2.10:7000/ics/taskOrder/addTask
> 适用于设备举着货架预占情况下发，如龙门架任务，设备到达龙门架后预占等待任务下发。
> 任务报文：

```json
{
    "modelProcessCode": "xiajiamubanhk33",  ----业务流程模板编号
    "priority": 6,   -----优先级  可不传
    "fromSystem": "wms",  -----任务来源系统
    "orderId": "9667666",   ---任务号
    "taskOrderDetail": [
        {
            "taskPath": "",    ----不用发
            "shelfNumber": "A0887",    ----货架编号
    		"deviceNum":"0988"    ----设备编号(若非预占不用发)
        }
    ]
}
```

